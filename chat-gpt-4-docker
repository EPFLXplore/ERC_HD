# Use an Ubuntu 22.04 base image for ARM64 architecture
FROM ubuntu:22.04

# Avoid interactive dialogue from apt-get
ENV DEBIAN_FRONTEND=noninteractive

# Update and install basic dependencies
RUN apt-get update && apt-get install -y \
    git \
    cmake \
    build-essential \
    curl \
    libssl-dev \
    libusb-1.0-0-dev \
    pkg-config \
    libgtk-3-dev \
    python3-dev \
    python3-numpy \
    && rm -rf /var/lib/apt/lists/*

# Install the Intel RealSense SDK 2.0 from source
RUN git clone https://github.com/IntelRealSense/librealsense.git \
    && cd librealsense \
    && git checkout `git tag | sort -V | grep -P "^v2" | tail -1` \ # This checks out the latest v2.x tag
&& mkdir build && cd build \
    && cmake ../ -DCMAKE_BUILD_TYPE=Release -DBUILD_EXAMPLES=true -DBUILD_WITH_CUDA=true \
    && make -j$(nproc) \
    && make install

# Setup environment variables
ENV LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH

# Cleanup the build
RUN apt-get clean && \
    rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* /librealsense

# Your application setup here

# Define default command
CMD ["bash"]
